<!DOCTYPE html>
<html lang="en">
    <head id="head">
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>GIFOS</title>
        <link rel="stylesheet" href="styles.css">
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/RecordRTC/5.5.6/RecordRTC.js"></script>
</head>
<body>
    <header>
        <div class="linea">
            
        </div>
        <img class="logomobile" src="images/logo-mobile.svg" alt="logo">
        <img class="logomobilenoct noc" src="images/logo-mobile-modo-noct.svg" alt="">
        <nav class="navegador">
            <input type="checkbox" class="navcb" id="navcb">
            <label for="navcb" class="label-nav">
                <img class="burger dia" src="images/burger.svg" alt="boton menu">
                <img class="burger noc" src="images/burger-modo-noct.svg" alt="boton menu">
                <img class="close dia" src="images/close.svg" alt="cerrar menu">
                <img class="close noc" src="images/close-modo-noct.svg" alt="cerrar menu">
                
            </label>
            <ul class="ul-nav">
                
                    <li class=""> <a href="#"  id="mode">Modo Nocturno</a></li>
                    <li class=""> <a href="#" id="favoritos">Favoritos</a></li>
                    <li class=""> <a href="#" id="misgifos">Mis GIFOS</a></li>
                    <li class="licreateday" id="abrircrear">
                        <img class="crear day" src="images/button-crear-gifo.svg" alt="crear" id="creategifo">
                        <img class="createhover" src="images/CTA-crear-gifo-hover.svg" alt="crear" id="creategifoactive">
                        <img class="createactive" src="images/CTA-crear-gifo-active.svg" alt="crear" id="creategifoactive">
                    </li>
                    <li class="licreatenoct" id="abrircrearnoc">
                        <img class="createnoc" src="images/CTA-crear-gifo-modo-noc.svg" alt="">
                        <img class="createnochover" src="images/CTA-crear-gifo-hover-modo-noc.svg" alt="">
                        <img class="createnocactive" src="images/CTA-crear-gifo-active-modo-noc.svg" alt="">
                    </li>
                    
                </ul>
        </nav>
    </header>
    <main>
        <div class="intro" id="intro"> 
            <h1 class="title">Inspírate, busca, guarda, y crea los mejores <span class="title GIFOS">GIFOS</span></h1>
            <img class="imgppal" src="images/ilustra_header.svg" alt="">
            <div class="search" id="search">
                <img class = "dnone" src="images/icon-search-modo-noct.svg" id="lupabuscador">
                <form action="" id="form">
                    <input type="search" placeholder="Buscá GIFOS y más..." id="busqueda" autocomplete="off">
                    <label for="submit">
                        <img class="lupita" src="images/icon-search.svg" alt="buscar" id="lupita">
                        <img  class="lens noc" src="images/icon-search-mod-noc.svg" alt="buscar">
                        <img class="dnone" src="images/close.svg" alt="cerrar" id="cerrar">
                </label>
            </form>
                <ul class="sugerenciascontainer" id="sugerenciascontainer">
                    
                </ul>
            </div>
            <h3 class="trending"> Trending: </h3>
        </div>  

        <section class="favoritos dnone" id="favsec">
            <img src="images/icon-favoritos.svg" alt="favoritos">
            <h2 class="favtitle">Favoritos</h2>
            <div class="favoritegallery" id="favoritegallery"></div>
            <img class="vermasday" src="images/CTA-ver-mas.svg" alt="ver mas" id="vermas">
            <img class="vermasnoc"src="images/CTA-ver+-modo-noc.svg" alt="ver mas" id="vermasfavnoc">
        </section>

        <section class="misgifossec dnone" id="misgifossec">
            <img src="images/icon-mis-gifos.svg" alt="">
            <h2 class="mgtitle">Mis GIFOS</h2>
            <div class="misgifoslist" id="misgifoslist"></div>
            <img class="vermasday" src="images/CTA-ver-mas.svg" alt="ver mas" id="vermasmisgifos">
            <img class="vermasnoc"src="images/CTA-ver+-modo-noc.svg" alt="ver mas" id="vermasmisgifosnoc">
        </section>

        <section class="dnone" id="crearGifo">
            <div class="containerCamara">
                <img class="camara" src="images/camara.svg" alt="camara">
                <img class="camaranoc" src="images/camara-modo-noc.svg" alt="">
                <img class="luzcamara" src="images/element-luz-camara.svg" alt="">
                <div class="containerCreacionGifos" id="containerCreacionGifos">
                    <h2 class="titleCrear" id="titleCrear">Aquí podrás crear tus propios GIFOS </h2>
                    <h2 class="dnone" id="acceso">¿Nos das acceso a tu cámara?</h2>
                    <p class="dnone" id="pAcceso">El acceso a tu camara será válido sólo por el tiempo en el que estés creando el GIFO.</p>
                        <p class="pCreacionGifos" id="pCreacionGifos">¡Crea tu GIFO en sólo 3 pasos!</p> 
                        <p class="pCreacionAclaracion" id="pCreacionAclaracion">(sólo necesitas una cámara para grabar un video)</p>
                    <video src="" id="video"></video>
                    <img class="dnone" id= "previewImgGif" src="" alt="Preview Gif"/>
                </div>
                <img class="cinta" src="images/pelicula.svg" alt="cinta">
                <img class="cintanoc" src="images/pelicula-modo-noc.svg" alt="cinta">
            </div>
            <div class="containerBotones">
                <p class="dnone" id="counter">00:00:00</p>
                <ul class="numbers">
                    <li class="number" id="1erpaso">1</li>
                    <li class="number" id="2dopaso">2</li>
                    <li class="number" id="3erpaso">3</li>
                </ul>
                <div class="linea grabarmg"></div>
                <p class="comenzar" id="comenzar">COMENZAR</p>
                <p class="dnone" id="grabar">GRABAR</p>
                <p class="dnone" id="finalizar">FINALIZAR</p>
                <p class="dnone" id="subir">SUBIR GIFO</p>
            </div>
        </section>

        <div class="resultados" id="resultados">
            <h2 class="buscadotitle" id="buscado"></h2>
            <div id="searchingResults" class=""></div>
            <img class="dnone" src="images/CTA-ver-mas.svg" alt="" id="vermasresultados">
        </div>

        <section class="lasttrending" id="lasttrending">
            <h2 class="trendingGifos">Trending GIFOS</h2>
            <p class="comunidad">Mira los ultimos GIFOS de nuestra comunidad</p>
            
            <img class="prev" src="images/button-slider-left.svg" alt="previous" id="prev">
            <img class="prevhover" src="images/button-slider-left-hover.svg" alt="" id="prevhover">
            <img class="prevnoct" src="images/button-slider-left-md-noct.svg" alt="previous" id="prevnoct">
            <img class="next" src="images/Button-Slider-right.svg" alt="" id="next">
            <img class="nexthover" src="images/button-slider-right-hover.svg" alt="" id="nexthover">
            <img class="nextnoct" src="images/button-slider-right-md-noct.svg" alt="next" id="nextnoct">
            
            <div class="gallery" id="gallery">
                
             
            </div>
            <div class="dnone" id="modal">
                <img class="cruz" src="images/close.svg" alt="cerrar" id="cruz">
 
                
            </div>
        </section>
        <footer>
            <p>Compartir en:</p>
            <div class="compartir">
                <a href="https://www.facebook.com/"><img src="images/icon_facebook.svg" alt=""></a>
                <a href="https://twitter.com/?lang=es"><img src="images/icon-twitter.svg" alt=""></a>
                <a href="https://www.instagram.com/?hl=es-la"><img src="images/icon_instagram.svg" alt=""></a>             
            </div>
            <div class="compartirnoc noc">
                <a href="https://www.facebook.com/"><img src="images/icon_facebook_noc.svg" alt=""></a>
                <a href="https://twitter.com/?lang=es"><img src="images/icon-tw-normal.svg" alt="tw"></a>
                <a href="https://www.instagram.com/?hl=es-la"><img src="images/icon_instagram_noc.svg" alt=""></a>
            </div>
            <p>GIFOS 2020 All Rights Reserved.</p>
            <div class="linea final">
                
            </div>
        </footer>
    </main>
</body>
<script>
    const favoritos = document.getElementById("favoritos")
    const misgifos = document.getElementById("misgifos")
    const favsec = document.getElementById("favsec")
    const misgifossec = document.getElementById("misgifossec")
    const intro = document.getElementById("intro")
    const gallery = document.getElementById("gallery")
    const creategifoactive = document.getElementById("abrircrear")
    const creategifonoc = document.getElementById("abrircrearnoc")
    const crearGifo = document.getElementById("crearGifo")
    const lasttrending = document.getElementById("lasttrending")

    favoritos.addEventListener("click", activarFavoritos)
    misgifos.addEventListener("click", activarMisGifos)
    creategifoactive.addEventListener("click", activarCrearGifo)
    creategifonoc.addEventListener("click", activarCrearGifo)

    const favoritegallery = document.getElementById("favoritegallery")
    const resultados = document.getElementById("resultados")

    function activarFavoritos(){
        favsec.classList.toggle("dnone");
        intro.classList.toggle("dnone");
        resultados.classList.toggle("dnone")

    }

    function activarMisGifos(){
        misgifossec.classList.toggle("dnone");
        intro.classList.toggle("dnone");
        resultados.classList.toggle("dnone")
    }

    function activarCrearGifo(){
        crearGifo.classList.toggle("crearGifo")
        intro.classList.toggle("dnone");
        resultados.classList.toggle("dnone")
        lasttrending.classList.toggle("dnone")
    }
    
    const trending = galery => {
        return `https://api.giphy.com/v1/gifs/trending?api_key=EjzvMRueNdiAkT3CvCjx0kOjl8qGzxLM`;
    }

    
    const prev = document.getElementById("prev")
    const next = document.getElementById("next")
    const prevhover = document.getElementById("prevhover")
    const nexthover = document.getElementById("nexthover")
    const prevnoct = document.getElementById("prevnoct")
    const nextnoct = document.getElementById("nextnoct")

    prevhover.addEventListener("click", scrollIzq)
    prevnoct.addEventListener("click", scrollIzq)
    nexthover.addEventListener("click", scrollDer)
    nextnoct.addEventListener("click", scrollDer)
 

    // section trending
    async function showResult() {
        // event.preventDefault();
        const response = await fetch(trending());
        const results = await response.json();
        gallery.innerHTML = ""
        renderResult(results.data, gallery, "slider", "mySlides", "gifcontainer");
        // showSlides()
        
        // prev.addEventListener("click", () => plusSlides(-1))
        // next.addEventListener("click", () => plusSlides(1))
        
    }

    

    const mySlides= document.getElementsByClassName("mySlides")

    function renderResult(results, container, clasecontainer, claseitem, classItemContainer) {
        results.forEach(item =>{
        const figure = document.createElement('figure');
        const img = document.createElement('img');
        const gifContainer = document.createElement("div")

        img.src = item.images.original.url;
        img.alt = item.title;
        img.p= item.username
        gifContainer.className = classItemContainer                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
        img.className = claseitem;
        img.id = item.id
        container.classList.add(clasecontainer);
        if (existeFavorito(item)){
            gifContainer.classList.add("favorite")
        }
        
        const favExpand = document.createElement("img")
        const favActiveExpand = document.createElement("img")
        const downloadExpand = document.createElement("img")
        const divExpandedIcons = document.createElement("div")
        const cruz = document.createElement("img")
        cruz.src = "images/close.svg"
        favExpand.src = "images/icon-fav-hover.svg"
        favActiveExpand.src = "images/icon-fav-active.svg"
        downloadExpand.src ="images/icon-download-hover.svg"
        cruz.className= "expanded cruz"
        favExpand.className = "expanded favear"
        favActiveExpand.className = "expanded faveado"
        downloadExpand.className = "expanded bajar"
        divExpandedIcons.className = "expandeddiv"
        downloadExpand.addEventListener("click", ()=> downloadIconGifo(img, gifContainer))
        favExpand.addEventListener("click", agregarFavoritos)
        favActiveExpand.addEventListener("click", eliminarFavoritos)

        const addToFavorites = () => {
            agregarFavoritos(item)
            gifContainer.classList.add("favorite")
        }
        const removeFromFavorites = () => {
            eliminarFavoritos(item)
            gifContainer.classList.remove("favorite")
        }
        const removeMisGifos = () => {
            eliminarMisGifos(item)
        }
        const expand = () => expandir(event, gifContainer, item)
        const overlay = imgHoverComponentFactory(item, expand, addToFavorites, removeFromFavorites, removeMisGifos)
        cruz.addEventListener("click", () => close(gifContainer))
        gifContainer.appendChild(overlay)

        gifContainer.appendChild(cruz)
        gifContainer.appendChild(img)
        divExpandedIcons.appendChild(favExpand)
        divExpandedIcons.appendChild(favActiveExpand)
        divExpandedIcons.appendChild(downloadExpand)
        gifContainer.appendChild(divExpandedIcons)
        container.appendChild(gifContainer);


        
    
    })
    }showResult()

   function close(gifContainer){
        gifContainer.classList.remove("modal")
   }


    const medidasGallery =gallery.getBoundingClientRect()
    const desplazar = medidasGallery.width/3
    
    

    var slideIndex = 1;

    // Next/previous controls
    // function plusSlides(n) {
    // showSlides(slideIndex += n);
    // }

    // // // Thumbnail image controls
    // function currentSlide(n) {
    // showSlides(slideIndex = n);
    // }

    // function showSlides(n) {
    // var i;
    // var slides = document.getElementsByClassName("mySlides");
 
    // if (n > slides.length) {slideIndex = 1}
    // if (n < 1) {slideIndex = slides.length}

    // for (i = 0; i < slides.length; i++) {
    //     slides[i].style.display = "none";
    // }
   
    // slides[slideIndex-1].style.display = "block";}

    
  
    function scrollDer(event){
        gallery.scrollLeft += desplazar;
        event.preventDefault()
    }

    function scrollIzq(event){
        gallery.scrollLeft -= desplazar;
        event.preventDefault()

    }
    
    

    // const modal = document.getElementById("modal")

    // function ampliar(ampliado, gifContainer, event){
    //     event.stopPropagation()  
    //     gifContainer.className = "modal"
    //     const imgs = gifContainer.querySelectorAll(".mySlides")
    //     const titles = gifContainer.querySelectorAll(".giftitle")
    //     const users = gifContainer.querySelectorAll(".user")

    //     if (imgs.length > 0){
    //         imgs.forEach(item => item.parentNode.removeChild(item))
    //         titles.forEach(item => item.parentNode.removeChild(item))
    //         users.forEach(item => item.parentNode.removeChild(item))
           
    //     }
    //     console.log(ampliado)
    //     const user = document.createElement("p")
    //     let imagen = document.createElement("img")
    //     const divtitle = document.createElement("div")

    //     imagen.src = ampliado.images.original.url
    //     user.innerText = ampliado.username 
    //     user.className = "user"
    //     divtitle.className = "divtitle"
    //     title = document.createElement("figcaption")
    //     title.innerText = ampliado.title
    //     title.className = "giftitle"
    //     gifContainer.appendChild(cruz)
    //     gifContainer.appendChild(imagen)
    //     divtitle.appendChild(user)
    //     divtitle.appendChild(title)
    //     gifContainer.appendChild(divtitle)
    //     gifContainer.appendChild(prev)
    //     gifContainer.appendChild(prevhover)
    //     gifContainer.appendChild(next)
    //     gifContainer.appendChild(nexthover)

    //     const violetFavHover = document.createElement("img")
    //     const violetFavActive = document.createElement("img")
    //     const violetDownloadHover = document.createElement("img")
    //     violetFavHover.src = "images/icon-fav-hover.svg"
    //     violetFavActive.src = "images/icon-fav-active.svg"  
    //     violetDownloadHover.src = "images/icon-download-hover.svg"
    //     violetFavHover.className = "violeticonshover favh"
    //     violetDownloadHover.className = "violeticonshover dlh"
    //     violetFavActive.className = "violetfavinactive"

    //     divtitle.appendChild(violetFavHover)
    //     divtitle.appendChild(violetFavActive)
    //     divtitle.appendChild(violetDownloadHover)
    //     violetFavHover.addEventListener("click", agregarFavoritos)
    //     violetFavActive.addEventListener("click", eliminarFavoritos)

    //     violetDownloadHover.addEventListener("click", () =>downloadIconGifo(ampliado, divtitle))
    //     cruz.addEventListener("click", () => cerrar(ampliado, gifContainer, "gifcontainer"))
    //     }   

    function expandir(event, gifContainer){
        event.stopPropagation()  
        gifContainer.classList.toggle("modal")
       

    }
    



    function imgHoverComponentFactory(item, expandir, agregarFavoritos, eliminarFavoritos, eliminarMisGifos){
        const violet = document.createElement("div")
        const violetFavHover = document.createElement("img")
        const violetFavActive = document.createElement("img")
        const violetDownloadHover = document.createElement("img")
        const violetExpandHover = document.createElement("img")
        const trash = document.createElement("img")
        
        violetFavHover.src = "images/icon-fav-hover.svg"
        violetFavActive.src = "images/icon-fav-active.svg"  
        violetDownloadHover.src = "images/icon-download-hover.svg"
        violetExpandHover.src = "images/icon-max-hover.svg"
        violet.src = "images/icon-max-hover.svg"
        trash.src = "images/icon-trash-hover.svg" 

        violet.className = "hoverviolet"
        violetExpandHover.className = "violeticonshover exph"
        violetFavHover.className = "violeticonshover favh"
        violetDownloadHover.className = "violeticonshover dlh"
        violetFavActive.className = "violetfavinactive"
        trash.className = "violeticonshover trash"

        title = document.createElement("figcaption")
        user = document.createElement("p")
        user.innerText = item.username
        user.className = "violetuser"
        title.innerText = item.title
        title.className = "violettitle"
        violet.appendChild(title)
        violet.appendChild(user)
        violet.appendChild(trash)
        violet.appendChild(violetFavHover)
        violet.appendChild(violetFavActive)
        violet.appendChild(violetDownloadHover)
        violet.appendChild(violetExpandHover)
    
        violetExpandHover.addEventListener("click", expandir) 
        violetFavHover.addEventListener("click", agregarFavoritos)
        violetFavActive.addEventListener("click", eliminarFavoritos)
        trash.addEventListener("click",eliminarMisGifos )
        violetDownloadHover.addEventListener("click", () =>downloadIconGifo(item, violet))

        return violet
    }

    const verMasFavoritos = document.getElementById("vermas")
    const verMasFavoritosNoc = document.getElementById("vermasfavnoc")
    const localStorageFavorites = JSON.parse(localStorage.getItem("listFavorites")) || [];
    if(localStorageFavorites == 0){
        const favoritosVacio = document.createElement("img")
        const favoritosVacioP = document.createElement("p")

        favoritosVacio.src= "images/icon-fav-sin-contenido.svg"
        favoritosVacioP.textContent = "¡Guarda tu primer GIFO en Favoritos para que se muestre aquí!"
        favoritosVacioP.className = "gifoVacioP"
        favoritegallery.className = "misgifoslist"
        verMasFavoritos.className = "dnone"
        verMasFavoritosNoc.className = "dnone"
        
        favoritegallery.appendChild(favoritosVacio)
        favoritegallery.appendChild(favoritosVacioP)
    }

    function existeFavorito(item){
        const idGifo = item.id;
        return localStorageFavorites.some((element) => {
                return element.id === idGifo;
        });
        
    }

    
    function agregarFavoritos(item) {

        const idGifo = item.id;
        const titleGifo = item.title;
        const userGifo = item.username;
        const urlGifo = item.images.original.url;

        const isFavorite = localStorageFavorites.some((element) => {
            return element.id === idGifo;
        });
        
        if(!isFavorite){   
            localStorageFavorites.push({
                id: idGifo,
                title: titleGifo,
                username: userGifo,
                images: { original: { url: urlGifo } },
            });
            localStorage.setItem(
                "listFavorites",
                JSON.stringify(localStorageFavorites)
            );
        }
    }

    function eliminarFavoritos(item){
        const localStorageFavorites = JSON.parse(localStorage.getItem("listFavorites")) || [];
        localStorage.setItem("listFavorites", JSON.stringify(localStorageFavorites.filter(favorite => favorite.id !== item.id)));

    }

    
    const form = document.getElementById("form")
    const input = document.getElementById("busqueda")
    const buscar = document.querySelector(".lupita")
    const search = document.getElementById("search")
    const cerrarBusqueda = document.getElementById("cerrar")
    const lupabuscador = document.getElementById("lupabuscador")

    const getUrl = (q, limit, offset) => {
        return `https://api.giphy.com/v1/gifs/search?api_key=EjzvMRueNdiAkT3CvCjx0kOjl8qGzxLM&q=${q}&limit=${limit}&offset=${offset}` ;
        }
    
    input.addEventListener("keyup", sugerir)
    form.addEventListener("submit", resultadosBusqueda)


    
    async function sugerir(){
        const q = input.value 
        const apiSugerencias = `https://api.giphy.com/v1/gifs/search/tags?api_key=EjzvMRueNdiAkT3CvCjx0kOjl8qGzxLM&q=${q}`
        const sugerenciasResponse = await fetch(apiSugerencias);
        const sugerenciasResults = await sugerenciasResponse.json();
        const sugerenciasData = sugerenciasResults.data

        
        const sugerenciasContainer = document.getElementById("sugerenciascontainer")
        lupabuscador.className = "eachlupa"
        const suggestions = sugerenciasData.filter(function(item) {
        return item.name.toLowerCase().startsWith(q);
        });
       
        sugerenciasContainer.innerHTML = ""

        suggestions.forEach(function(suggested) {
            const sugerencia = document.createElement('li');
            sugerencia.innerHTML = `<img class = "eachlupa" src="images/icon-search-modo-noct.svg">${suggested.name}`
            sugerencia.className = "sugerencia"
            const lupaHover = document.createElement("img")
            sugerenciasContainer.appendChild(sugerencia);
            sugerencia.addEventListener("click", autocompletar)

       
        });

        buscar.className = "dnone"
        cerrarBusqueda.className = "cerrarbusqueda"

        function autocompletar(event, sugerencia){
            input.value = event.target.textContent
            resultadosBusqueda(event) 
            sugerenciasContainer.className = "dnone"
            
            
        }

    }


    let offset = 0
    const limit = 12

    const searchingResults = document.getElementById("searchingResults")
    const verMas = document.getElementById("vermasresultados")

    async function resultadosBusqueda(event) {
            event.preventDefault();
            const buscado = document.getElementById("buscado")
            searchingResults.innerHTML =""
            buscado.textContent= ""
            searchingResults.classList.remove("notfound")
            resultados.classList.remove("resultsnotfound")
            const q = input.value.split(" ").join("-")
            const url = getUrl(q, limit, offset);
            const response = await fetch(url);
            const results = await response.json();
            buscado.innerText = input.value
            console.log(results.pagination.total_count)
            verMas.className ="vermas"
            if (results.data.length){
                renderResult(results.data, searchingResults, "resultados", "imgresultados", "gifcontainer busqueda");
                verMas.addEventListener("click", cargarMas)}
            else{
                searchingResults.classList.add("notfound")
                resultados.classList.add("resultsnotfound")
                const ouch = document.createElement("img")
                const otra = document.createElement("figcaption")

                ouch.src = "images/icon-busqueda-sin-resultado.svg"
                otra.innerText = "Intenta con otra búsqueda"
                otra.className = "otra"

                searchingResults.appendChild(ouch)
                searchingResults.appendChild(otra)
            }



        }

    async function downloadIconGifo(item, contenedor) {
        const a = document.createElement("a");
        let response = await fetch(item.images.original.url);
        let file = await response.blob();
        a.download = item.title;
        a.href = window.URL.createObjectURL(file);
        a.dataset.downloadurl = ["application/octet-stream", a.download, a.href].join(
            ":"
        );
        contenedor.appendChild(a);
        a.click()
        return a;
    }
    async function downloadIconMyGifo(item, contenedor) {
        const a = document.createElement("a");
        console.log(item)
        let response = await fetch(item.data.images.url);
        let file = await response.blob();
        a.download = item.title;
        a.href = window.URL.createObjectURL(file);
        a.dataset.downloadurl = ["application/octet-stream", a.download, a.href].join(
            ":"
        );
        contenedor.appendChild(a);
        a.click()
        return a;
    }
  
    
    async function cargarMas(){
        const q = input.value.split(" ").join("-")
        const url = getUrl(q, limit, offset+=12);
        const response = await fetch(url);
        const results = await response.json();  
        renderResult(results.data, resultados, "resultados", "imgresultados","gifcontainer busqueda" )

        console.log(results.pagination.total_count)
        console.log(results.pagination.total_count - offset)
        if(results.pagination.total_count - offset <  offset){
            verMas.style.display = "none"
        }
    }    

    
       
    async function palabrasTendencia(){
        const tendencias = "https://api.giphy.com/v1/trending/searches?api_key=EjzvMRueNdiAkT3CvCjx0kOjl8qGzxLM"
        const tendenciasResponse = await fetch(tendencias);
        const tendenciasResults = await tendenciasResponse.json();
        const tendenciasMasFuertes = tendenciasResults.data.splice(0,5)
        const tendenciasActuales = document.createElement("p")
        tendenciasActuales.innerText = tendenciasMasFuertes
        tendenciasActuales.className = "tendenciasActuales"
        intro.appendChild(tendenciasActuales)
       
    }

    palabrasTendencia()
    
    function misFavoritos(){
        const localStorageFavorites = JSON.parse(localStorage.getItem("listFavorites")) || [];
        renderResult(localStorageFavorites, favoritegallery, "resultados", "imgresultados", "searchresults")
        console.log(localStorageFavorites.length)
   
        // comparar offset con largo de favoritos. comparar offset mas limit contra el largo de favoritos.
    }
    misFavoritos()

    // const busqueda = "cat";
    // const url = `http://api.giphy.com/v1/gifs/search?api_key=EjzvMRueNdiAkT3CvCjx0kOjl8qGzxLM&q=${busqueda}`
    // fetch(url)
    // .then(response => response.json())
    // .then(data => console.log(data));

    const comenzar = document.getElementById("comenzar")
    comenzar.addEventListener("click", solicitudPermiso)

    const acceso = document.getElementById("acceso")
    const pAcceso = document.getElementById("pAcceso")
    const titleCrear = document.getElementById("titleCrear")
    const pCreacionGifos = document.getElementById("pCreacionGifos")
    const pCreacionAclaracion = document.getElementById("pCreacionAclaracion")
    const primerPaso = document.getElementById("1erpaso")
    const segundoPaso = document.getElementById("2dopaso")
    const tercerPaso = document.getElementById("3erpaso")
    const video = document.getElementById("video")
    const grabar = document.getElementById("grabar")

    function solicitudPermiso(){
        comenzar.className = "dnone"
        acceso.className = "titleCrear"
        pAcceso.className = "pCreacionGifos"
        titleCrear.className ="dnone"
        pCreacionGifos.className ="dnone"
        pCreacionAclaracion.className ="dnone"
        primerPaso.className= "pasosHover"
        getStreamAndRecord()
    }
    
    
    let stream
    let recorder
    async function getStreamAndRecord () { 
        stream = await navigator.mediaDevices.getUserMedia({
        audio: false,
        video: {
            height: { max: 450 }
        }
        })
        if (stream.active === true) {
        video.srcObject = stream;
        video.play()
        acceso.className = "dnone"
        pAcceso.className = "dnone"
        primerPaso.className= "number"
        segundoPaso.className = "pasosHover"
        grabar.className ="comenzar"
        recorder = RecordRTC(stream, {
            type: 'gif',
            frameRate: 1,
            quality: 10,
            width: 360,
            hidden: 240,
        })
        grabar.addEventListener("click", () => onGifRecordingStarted(recorder))
        }}


    function onGifRecordingStarted(recorder) {
        recorder.startRecording();
        timer();
        counter.className = "counter"
        finalizar.className = "comenzar"
        grabar.className = "dnone"
    }   

    const counter = document.getElementById("counter")
    const finalizar = document.getElementById("finalizar")
    const subir = document.getElementById("subir")

    function timer() {
        let sec = 0;
        let min = 0;
        let hour = 0;
        countdown = setInterval(function () {
            counter.innerHTML = `${hour}:${min}:${sec}`;
            sec++;
            if (sec == 60) {
            sec = 0;
            min++;
            if (min == 60) { 
                min = 0;
                hour++;
            }
            }
        }, 1000);
    }

    finalizar.addEventListener("click", detenerGrabacion)
    
    let previewImg = document.getElementById("previewImgGif")
    const misgifoslist = document.getElementById("misgifoslist")
    function detenerGrabacion(){
        recorder.stopRecording()
        clearInterval(countdown);
        counter.innerHTML = "REPETIR CAPTURA";
        subir.className = "comenzar"
        finalizar.className = "dnone"
        let blob
        blob = recorder.getBlob();
        let urlCreator = window.URL || window.webkitURL;
        imageUrl = urlCreator.createObjectURL(blob);
        previewImg.src = imageUrl;
        video.style.display = "none";
        previewImg.style.display = "block";
        finalizar.className= "dnone";
        counter.addEventListener("click", repeatCapture);
    }

    subir.addEventListener("click", subirGifo)

    function repeatCapture(){
        previewImg.src=""
        subir.className = "dnone"
        counter.className = "dnone"
        video.style.display = "inline-block"
        solicitudPermiso()
    }
    const verMasMisGifosNoc = document.getElementById("vermasmisgifosnoc")
    const localStorageMisGifos = JSON.parse(localStorage.getItem("listMisGifos")) || [];
    if(localStorageMisGifos.length == 0){
        const gifoVacio = document.createElement("img")
        const gifoVacioP = document.createElement("h2")
        const verMasMisGifos = document.getElementById("vermasmisgifos")

        gifoVacio.src = "images/icon-mis-gifos-sin-contenido.svg"
        gifoVacioP.textContent = "¡Anímate a crear tu primer GIFO!"
        gifoVacioP.className = "gifoVacioP"
        verMasMisGifos.style.display = "none"
        verMasMisGifosNoc.style.display = "none"

        misgifoslist.appendChild(gifoVacio)
        misgifoslist.appendChild(gifoVacioP)

        console.log("esta vacio, ves? no hay monstruos aqui")
    }else{
        misgifoslist.className = "hayGifs"
    }

    async function subirGifo(){
        segundoPaso.className = "number"
        tercerPaso.className = "pasosHover"
        counter.className = "dnone"
        const template = uploadingOverlay()
        const containerCreacionGifos = document.getElementById("containerCreacionGifos")
        containerCreacionGifos.appendChild(template)
        console.log(template)
        let formData = new FormData();
        formData.append("file", recorder.getBlob(), "myGif.gif");
        formData.append("tags", "");
        const uploadGif = await fetch(
            `https://upload.giphy.com/v1/gifs?api_key=EjzvMRueNdiAkT3CvCjx0kOjl8qGzxLM`,
            {
            method: "POST",
            body: formData,
            mode: 'cors'
            }
        );
    
    const resUpload = await uploadGif.json();

    
    if (resUpload.meta.status === 200) {
        template.classList.add("uploadOk")
        subir.className = "dnone"
        console.log(resUpload)
        const resultadoUpload = await fetch (`https://api.giphy.com/v1/gifs/${resUpload.data.id}?api_key=EjzvMRueNdiAkT3CvCjx0kOjl8qGzxLM`);
        const res = await resultadoUpload.json();
        console.log(res);
        // iconLink.href = res.data.url;
        localStorageMisGifos.push({
        id: res.data.id,
        title: res.data.title,
        username: res.data.username,
        images: { original: { url: res.data.images.original.url } },
        });

        localStorage.setItem(
        "listMisGifos",
        JSON.stringify(localStorageMisGifos)
        );
    }
    }

    function misGifos(){
        const localStorageMisGifos = JSON.parse(localStorage.getItem("listMisGifos")) || [];
        renderResult(localStorageMisGifos, misgifoslist, "resultados", "imgresultados", "searchresults agregadomisgifos")

    }
    misGifos()
    

    function uploadingOverlay(){
        const uploadOverlay = document.createElement("div")
        const subiendo = document.createElement("p")
        const exito = document.createElement("p")
        const loader = document.createElement("img")
        const downloadMyGifo = document.createElement("img")
        const linkMyGifo = document.createElement("img")
        const check = document.createElement("img")
        const divBotonesSubido = document.createElement("div")

        loader.src = "images/loader.svg"
        check.src = "images/check.svg"
        downloadMyGifo.src = "images/icon-download-hover.svg"
        linkMyGifo.src = "images/icon-link-hover.svg"
        
        loader.className = "loader"
        check.className = "check"
        uploadOverlay.className = "uploadViolet"
        downloadMyGifo.className = "downloadmygifo"
        linkMyGifo.className = "linkmygifo"
        subiendo.textContent = "Estamos subiendo tu GIFO"
        subiendo.className = "subiendoP"
        exito.textContent = "GIFO subido con éxito"
        exito.className = "exitoP"
        divBotonesSubido.className = "divbotonessubido"
        
        divBotonesSubido.appendChild(downloadMyGifo)
        divBotonesSubido.appendChild(linkMyGifo)
        uploadOverlay.appendChild(divBotonesSubido)
        uploadOverlay.appendChild(loader)
        uploadOverlay.appendChild(subiendo)
        uploadOverlay.appendChild(check)
        uploadOverlay.appendChild(exito)


        downloadMyGifo.addEventListener("click", downloadIconMyGifo)

        return uploadOverlay
    }

    function eliminarMisGifos(item){
        localStorage.setItem("listMisGifos", JSON.stringify(localStorageMisGifos.filter(migifo => migifo.id !== item.id)));
    }


    
    const head = document.getElementById("head")
    const link = document.createElement('link')
    const mode = document.getElementById("mode")
    mode.addEventListener("click", cambiarModo)
    
    function cambiarModo(){
        if(link.innerHTML === ""){
            link.innerHTML = `<link rel="stylesheet" href="stylesdarkmode.css">`
            head.appendChild(link)
        }

       changeText()
    }
    function changeText() {
        if (mode.textContent === 'Modo Nocturno') {
            mode.textContent = 'Modo Diurno';
        } else if (mode.textContent === 'Modo Diurno') {
            mode.textContent = 'Modo Nocturno';
            head.removeChild(link)
        }
}
</script>
</html>
