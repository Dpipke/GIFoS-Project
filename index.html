<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GIFOS</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <div class="linea">

        </div>
        <img class="logomobile" src="images/logo-mobile.svg" alt="logo">
        <img class="logomobilenoct noc" src="images/logo-mobile-modo-noct.svg" alt="">
        <nav class="navegador">
            <input type="checkbox" class="navcb" id="navcb">
            <label for="navcb" class="label-nav">
                <img class="burger dia" src="images/burger.svg" alt="boton menu">
                <img class="burger noc" src="images/burger-modo-noct.svg" alt="boton menu">
                <img class="close dia" src="images/Button-close-modo-noc.svg" alt="cerrar menu">
                <img class="close noc" src="images/Button-close-hover-modo-noc.svg" alt="cerrar menu">
                
            </label>
            <ul class="ul-nav">
                
                    <li class=""> <a href="#">Modo Nocturno</a></li>
                    <li class=""> <a href="#" id="favoritos">Favoritos</a></li>
                    <li class=""> <a href="#">Mis GIFOS</a></li>
                    <li><img class="crear day" src="images/button-crear-gifo.svg" alt="crear"></li>
                    <li><img class="crear" src="images/CTA-crear-gifo-hover.svg" alt="crear"></li>
                    <li><img class="crear" src="images/CTA-crear-gifo-active.svg" alt="crear"></li>


            </ul>
        </nav>
    </header>
    <main>
        <div class="intro" id="intro"> 
            <h1 class="title">Inspírate, busca, guarda, y crea los mejores <span class="title GIFOS">GIFOS</span></h1>
            <img class="imgppal" src="images/ilustra_header.svg" alt="">
            <div class="search" id="search">
                <img class = "dnone" src="images/icon-search-modo-noct.svg" id="lupabuscador">
                <form action="" id="form">
                    <input type="search" placeholder="Buscá GIFOS y más..." id="busqueda">
                    <label for="submit">
                        <img class="lupita" src="images/icon-search.svg" alt="buscar" id="lupita">
                        <img  class="noc" src="images/icon-search-mod-noc.svg" alt="buscar">
                        <img class="dnone" src="images/close.svg" alt="cerrar" id="cerrar">
                </label>
                </form>
                <ul class="sugerenciascontainer" id="sugerenciascontainer">
                    
                </ul>
            </div>
            <h3 class="trending"> Trending: </h3>
        </div>  

        <section class="favoritos dnone" id="favsec">
            <img src="images/icon-favoritos.svg" alt="favoritos">
            <h2 class="favtitle">Favoritos</h2>
            <img src="images/CTA-ver-mas.svg" alt="ver mas" id="vermas">
        </section>

        <section class="dnone">
            <img src="images/icon-mis-gifos.svg" alt="">
            <h2 class="mgtitle">Mis GIFOS</h2>
            <img src="images/CTA-ver-mas.svg" alt="ver mas">
        </section>

        <div class="resultados" id="resultados">
            <img class="dnone" src="images/CTA-ver-mas.svg" alt="" id="vermasresultados">
        </div>

        <section class="lasttrending">
            <h2 class="trendingGifos">Trending GIFOS</h2>
            <p class="comunidad">Mira los ultimos GIFOS de nuestra comunidad</p>
            
            <img class="prev" src="images/button-slider-left.svg" alt="" id="prev">
            <img class="next" src="images/Button-Slider-right.svg" alt="" id="next">

            <div class="gallery" id="gallery">
                
             
            </div>
            <div class="dnone" id="modal">
                <img class="cruz" src="images/close.svg" alt="cerrar" id="cruz">
                <img class="like" src="images/icon-fav-hover.svg" alt="" id="like">
                <img class="dnone" src="images/icon-fav-active.svg" alt="" id="likehover">
                <img class= "download" src="images/icon-download.svg" alt="" id="download">

            </div>
        </section>
        <footer>
            <p>Compartir en:</p>
            <div class="compartir">
                <a href="https://www.facebook.com/"><img src="images/icon_facebook.svg" alt=""></a>
                <a href="https://twitter.com/?lang=es"><img src="images/icon-twitter.svg" alt=""></a>
                <a href="https://www.instagram.com/?hl=es-la"><img src="images/icon_instagram.svg" alt=""></a>             
            </div>
            <div class="compartirnoc noc">
                <a href="https://www.facebook.com/"><img src="images/icon_facebook_noc.svg" alt=""></a>
                <a href="https://twitter.com/?lang=es"><img src="images/icon-tw-normal.svg" alt=""></a>
                <a href="https://www.instagram.com/?hl=es-la"><img src="images/icon_instagram_noc.svg" alt=""></a>
            </div>
            <p>GIFOS 2020 All Rights Reserved.</p>
            <div class="linea final">

            </div>
        </footer>
    </main>
</body>
<script>
    const favoritos = document.getElementById("favoritos")
    const favsec = document.getElementById("favsec")
    const intro = document.getElementById("intro")
    const gallery = document.getElementById("gallery")
    favoritos.addEventListener("click", activarFavoritos)

    function activarFavoritos(){
        favsec.classList.toggle("dnone");
        intro.classList.toggle("dnone");

    }

    
    const trending = galery => {
        return `https://api.giphy.com/v1/gifs/trending?api_key=EjzvMRueNdiAkT3CvCjx0kOjl8qGzxLM`;
    }

    
    const prev = document.getElementById("prev")
    const next = document.getElementById("next")

    prev.addEventListener("click", scrollIzq)
    next.addEventListener("click", scrollDer)
 

    // section trending
    async function showResult() {
        // event.preventDefault();
        const response = await fetch(trending());
        const results = await response.json();
        gallery.innerHTML = ""
        renderResult(results.data, gallery, "slider", "mySlides", "gifcontainer");
        // showSlides()
        console.log(results)
        
        // prev.addEventListener("click", () => plusSlides(-1))
        // next.addEventListener("click", () => plusSlides(1))
        
    }

    

    const mySlides= document.getElementsByClassName("mySlides")

    function renderResult(results, container, clasecontainer, claseitem, classItemContainer) {
        results.forEach(item =>{
        const figure = document.createElement('figure');
        const img = document.createElement('img');
        const gifContainer = document.createElement("div")

        img.src = item.images.original.url;
        img.alt = item.title;
        img.p= item.username
        container.classList.toggle(clasecontainer)
        gifContainer.className = classItemContainer                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
        img.className = claseitem;
        img.setAttribute("id", item.id)
        container.classList.add(clasecontainer);
        
        
        gifContainer.appendChild(img)
        img.addEventListener("click", event => ampliar(event, img)) 
        const overlay = imgHoverComponentFactory(img)
        container.appendChild(overlay)
        container.appendChild(gifContainer);
        console.log(overlay)
        
    
    })
    }showResult()

    const fav = document.getElementById("like")
    const favhover = document.getElementById("likehover")


    const medidasGallery =gallery.getBoundingClientRect()
    const desplazar = medidasGallery.width/3
    
    

    var slideIndex = 1;

    // Next/previous controls
    // function plusSlides(n) {
    // showSlides(slideIndex += n);
    // }

    // // // Thumbnail image controls
    // function currentSlide(n) {
    // showSlides(slideIndex = n);
    // }

    // function showSlides(n) {
    // var i;
    // var slides = document.getElementsByClassName("mySlides");
 
    // if (n > slides.length) {slideIndex = 1}
    // if (n < 1) {slideIndex = slides.length}

    // for (i = 0; i < slides.length; i++) {
    //     slides[i].style.display = "none";
    // }
   
    // slides[slideIndex-1].style.display = "block";}

    
  
    function scrollDer(event){
        gallery.scrollLeft += desplazar;
        event.preventDefault()
    }

    function scrollIzq(event){
        gallery.scrollLeft -= desplazar;
        event.preventDefault()

    }
    
    

    const modal = document.getElementById("modal")

    function ampliar(event, ampliado){
        event.stopPropagation()  
        modal.className = "modal"
        const imgs = modal.querySelectorAll(".mySlides")
        const titles = modal.querySelectorAll(".giftitle")
        const users = modal.querySelectorAll(".user")

        if (imgs.length > 0){
            imgs.forEach(item => item.parentNode.removeChild(item))
            titles.forEach(item => item.parentNode.removeChild(item))
            users.forEach(item => item.parentNode.removeChild(item))
           
        }

        modal.appendChild(ampliado)
        const user = document.createElement("p")

        user.innerText = ampliado.username 
        user.className = "user"
        modal.appendChild(user)
        title = document.createElement("figcaption")
        title.innerText = ampliado.alt
        title.className = "giftitle"
        modal.appendChild(title)

        const idGifo = modal.querySelector(".mySlides").getAttribute("id");
        console.log(idGifo);
        const validate = localStorageFavorites.findIndex(
            (item) => item.id === idGifo
        );
        console.log(validate);
        if (validate !== -1) {
            fav.className = "dnone";
            favhover.className = "like";
            this.removeEventListener("click", agregarFavoritos);
         // this.addEventListener("click", eliminarFavoritos);
        } else {
            fav.className = "like";
            favhover.className = "dnone";
            // this.removeEventListener("click", eliminarFavoritos);
            this.addEventListener("click", agregarFavoritos);
        }
        }   

    

    const cruz = document.getElementById("cruz")
    cruz.addEventListener("click", ()=> cerrar(modal))

    function cerrar(elemento){
        elemento.classList.add("dnone")
    }

    function imgHoverComponentFactory(item){
        const violet = document.createElement("div")
        const violetFav = document.createElement("img")
        const violetFavHover = document.createElement("img")
        const violetFavActive = document.createElement("img")
        const violetDownload = document.createElement("img")
        const violetDownloadHover = document.createElement("img")
        const violetExpand = document.createElement("img")
        const violetExpandHover = document.createElement("img")
        
        violetFav.src = "images/icon-fav.svg"
        violetFavHover.src = "images/icon-fav-hover.svg"
        violetFavActive.src = "images/icon-fav-active.svg"
        violetDownload.src = "images/icon-download.svg"
        violetDownloadHover.src = "images/icon-download-hover.svg"
        violetExpand.src = "images/icon-max-normal.svg"
        violet.src = "images/icon-max-hover.svg"

        violet.className = "hoverviolet"
        violetFav.className = "violeticons"
        violetDownload.className = "violeticons"
        violetExpand.className = "violeticons"
        violetFavHover.className = "violeticonshover"
        violetDownloadHover.className = "violeticonshover"
        violetFavActive.className = "violetfavactive"

        violet.appendChild(violetFav)
        violet.appendChild(violetFavHover)
        violet.appendChild(violetFavActive)
        violet.appendChild(violetDownload)
        violet.appendChild(violetDownloadHover)
        violet.appendChild(violetExpand)
        violet.appendChild(violetExpandHover)

        return violet
    }

    

    const localStorageFavorites = JSON.parse(localStorage.getItem("listFavorites")) || [];
    
    async function agregarFavoritos(ampliado) {
        const idGifo = this.parentElement.querySelector(".mySlides").getAttribute("id");
        const titleGifo = this.parentElement.querySelector(".mySlides").getAttribute("alt");
        const userGifo = this.parentElement.querySelector(".mySlides").getAttribute("p"); 
        const urlGifo = this.parentElement.querySelector(".mySlides").getAttribute("src"); 

      fav.className = "dnone";
      favhover.className = "like";

      localStorageFavorites.push({
        id: idGifo,
        title: titleGifo,
        username: userGifo,
        images: { original: { url: urlGifo } },
      });
      localStorage.setItem(
        "listFavorites",
        JSON.stringify(localStorageFavorites)
      );
    }
    // async function eliminarFavoritos(){

    // }

    
    const form = document.getElementById("form")
    const input = document.getElementById("busqueda")
    const buscar = document.querySelector(".lupita")
    const search = document.getElementById("search")
    const cerrarBusqueda = document.getElementById("cerrar")
    const lupabuscador = document.getElementById("lupabuscador")

    const getUrl = (q, limit, offset) => {
            return `https://api.giphy.com/v1/gifs/search?api_key=EjzvMRueNdiAkT3CvCjx0kOjl8qGzxLM&q=${q}&limit=${limit}&offset=${offset}` ;
        }
    
    input.addEventListener("keyup", sugerir)
    form.addEventListener("submit", resultadosBusqueda)


    
    async function sugerir(){
        const q = input.value 
        const apiSugerencias = `https://api.giphy.com/v1/gifs/search/tags?api_key=EjzvMRueNdiAkT3CvCjx0kOjl8qGzxLM&q=${q}`
        const sugerenciasResponse = await fetch(apiSugerencias);
        const sugerenciasResults = await sugerenciasResponse.json();
        const sugerenciasData = sugerenciasResults.data
        console.log(sugerenciasData)

        
        const sugerenciasContainer = document.getElementById("sugerenciascontainer")
        lupabuscador.className = "eachlupa"
        const suggestions = sugerenciasData.filter(function(item) {
        return item.name.toLowerCase().startsWith(q);
        });
       
        sugerenciasContainer.innerHTML = ""

        suggestions.forEach(function(suggested) {
            const sugerencia = document.createElement('li');
            sugerencia.innerHTML = `<img class = "eachlupa" src="images/icon-search-modo-noct.svg">${suggested.name}`
            sugerencia.className = "sugerencia"
            const lupaHover = document.createElement("img")
            sugerenciasContainer.appendChild(sugerencia);
            sugerencia.addEventListener("click", autocompletar)
            
            // add event listener con input.value. funcion q tome suggested.name y lo asigne al input.value 
            // esa fx ponerla como listener para sugenreical
       
        });

        buscar.className = "dnone"
        cerrarBusqueda.className = "cerrarbusqueda"

        function autocompletar(event, sugerencia){
            input.value = event.target.textContent
            resultadosBusqueda(event) 
            sugerenciasContainer.className = "dnone"
            
            
        }

    }

    cerrarBusqueda.addEventListener("click", ()=> {cerrar(cerrarBusqueda)&(input.value = "")})


    let offset = 0
    const limit = 12

    const resultados = document.getElementById("resultados")
    async function resultadosBusqueda(event) {
            event.preventDefault();
            const q = input.value.split(" ").join("-")
            const url = getUrl(q, limit, offset);
            const response = await fetch(url);
            const results = await response.json();
            const buscado = document.createElement("h2")
            buscado.innerText = input.value
            buscado.className = "buscadotitle"
            resultados.appendChild(buscado)
            const verMas = document.getElementById("vermasresultados")
            verMas.className ="vermas"
            if(response.status === 200){
                renderResult(results.data, resultados, "resultados", "imgresultados" );
                verMas.addEventListener("click", cargarMas)}
            else{
                const ouch = document.createElement("img")
                const otra = document.createElement("figcaption")

                ouch.src = "images/icon-busqueda-sin-resultado.svg"
                otra.innerText = "Intenta con otra búsqueda"
                otra.className = "otra"

                resultados.appendChild(ouch)
                resultados.appendChild(otra)
            }



        }

        // escuchar en el form, submit, no click
    
  
    
    async function cargarMas(){
        const q = input.value.split(" ").join("-")
        const url = getUrl(q, limit, offset+=12);
        console.log(url)
        const response = await fetch(url);
        const results = await response.json();  
        renderResult(results.data, resultados, "resultados", "imgresultados" )
    


    }    

    
       
    async function palabrasTendencia(){
        const tendencias = "https://api.giphy.com/v1/trending/searches?api_key=EjzvMRueNdiAkT3CvCjx0kOjl8qGzxLM"
        const tendenciasResponse = await fetch(tendencias);
        const tendenciasResults = await tendenciasResponse.json();
        const tendenciasMasFuertes = tendenciasResults.data.splice(0,5)
        const tendenciasActuales = document.createElement("p")
        tendenciasActuales.innerText = tendenciasMasFuertes
        tendenciasActuales.className = "tendenciasActuales"
        intro.appendChild(tendenciasActuales)
       
    }

    palabrasTendencia()
    


    // const busqueda = "cat";
    // const url = `http://api.giphy.com/v1/gifs/search?api_key=EjzvMRueNdiAkT3CvCjx0kOjl8qGzxLM&q=${busqueda}`
    // fetch(url)
    // .then(response => response.json())
    // .then(data => console.log(data));
</script>
</html>
